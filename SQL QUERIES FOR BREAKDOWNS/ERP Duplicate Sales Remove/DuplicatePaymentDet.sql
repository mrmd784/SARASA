WITH CTE ([RowNo]
      ,[PayTypeID]
      ,[Amount]
      ,[Balance]
      ,[SDate]
      ,[Receipt]
      ,[LocationID]
      ,[CashierID]
      ,[UnitNo]
      ,[BillTypeID]
      ,[SaleTypeID]
      ,[RefNo]
      ,[BankId]
      ,[ChequeDate]
      ,[IsRecallAdv]
      ,[RecallNo]
      ,[Descrip]
      ,[EnCodeName]
      ,[UpdatedBy]
      ,[Status]
      ,[ZNo]
      ,[CustomerId]
      ,[CustomerType]
      ,[CustomerCode]
      ,[GroupOfCompanyID]
      ,[Datatransfer]
      ,[ZDate]
      ,[TerminalID]
      ,[LoyaltyType]
      ,[IsUploadToGL]
      ,[LocationIDBilling]
      ,[TableID]
      ,[TicketID]
      ,[OrderNo]
      ,[ShiftNo]
      ,[IsDayEnd]
      ,[UpdateUnitNo]
      ,[SaleStatus]
      ,[RecallAvdInvoice]
      ,[AdvaneReceiptNo]
      ,[LoyaltyCardMasterID]
      ,[NOS]
      ,[CurrencyID]
      ,[CurrencyRate]
      /*,[CreatedOn]*/,DuplicateCount)
AS
(
  SELECT [RowNo]
      ,[PayTypeID]
      ,[Amount]
      ,[Balance]
      ,[SDate]
      ,[Receipt]
      ,[LocationID]
      ,[CashierID]
      ,[UnitNo]
      ,[BillTypeID]
      ,[SaleTypeID]
      ,[RefNo]
      ,[BankId]
      ,[ChequeDate]
      ,[IsRecallAdv]
      ,[RecallNo]
      ,[Descrip]
      ,[EnCodeName]
      ,[UpdatedBy]
      ,[Status]
      ,[ZNo]
      ,[CustomerId]
      ,[CustomerType]
      ,[CustomerCode]
      ,[GroupOfCompanyID]
      ,[Datatransfer]
      ,[ZDate]
      ,[TerminalID]
      ,[LoyaltyType]
      ,[IsUploadToGL]
      ,[LocationIDBilling]
      ,[TableID]
      ,[TicketID]
      ,[OrderNo]
      ,[ShiftNo]
      ,[IsDayEnd]
      ,[UpdateUnitNo]
      ,[SaleStatus]
      ,[RecallAvdInvoice]
      ,[AdvaneReceiptNo]
      ,[LoyaltyCardMasterID]
      ,[NOS]
      ,[CurrencyID]
      ,[CurrencyRate]
      /*,[CreatedOn]*/,
  ROW_NUMBER() OVER(PARTITION BY [RowNo]
      ,[PayTypeID]
      ,[Amount]
      ,[Balance]
      ,[SDate]
      ,[Receipt]
      ,[LocationID]
      ,[CashierID]
      ,[UnitNo]
      ,[BillTypeID]
      ,[SaleTypeID]
      ,[RefNo]
      ,[BankId]
      ,[ChequeDate]
      ,[IsRecallAdv]
      ,[RecallNo]
      ,[Descrip]
      ,[EnCodeName]
      ,[UpdatedBy]
      ,[Status]
      ,[ZNo]
      ,[CustomerId]
      ,[CustomerType]
      ,[CustomerCode]
      ,[GroupOfCompanyID]
      ,[Datatransfer]
      ,[ZDate]
      ,[TerminalID]
      ,[LoyaltyType]
      ,[IsUploadToGL]
      ,[LocationIDBilling]
      ,[TableID]
      ,[TicketID]
      ,[OrderNo]
      ,[ShiftNo]
      ,[IsDayEnd]
      ,[UpdateUnitNo]
      ,[SaleStatus]
      ,[RecallAvdInvoice]
      ,[AdvaneReceiptNo]
      ,[LoyaltyCardMasterID]
      ,[NOS]
      ,[CurrencyID]
      ,[CurrencyRate]
      /*,[CreatedOn]*/
   ORDER BY [RowNo]
      ,[PayTypeID]
      ,[Amount]
      ,[Balance]
      ,[SDate]
      ,[Receipt]
      ,[LocationID]
      ,[CashierID]
      ,[UnitNo]
      ,[BillTypeID]
      ,[SaleTypeID]
      ,[RefNo]
      ,[BankId]
      ,[ChequeDate]
      ,[IsRecallAdv]
      ,[RecallNo]
      ,[Descrip]
      ,[EnCodeName]
      ,[UpdatedBy]
      ,[Status]
      ,[ZNo]
      ,[CustomerId]
      ,[CustomerType]
      ,[CustomerCode]
      ,[GroupOfCompanyID]
      ,[Datatransfer]
      ,[ZDate]
      ,[TerminalID]
      ,[LoyaltyType]
      ,[IsUploadToGL]
      ,[LocationIDBilling]
      ,[TableID]
      ,[TicketID]
      ,[OrderNo]
      ,[ShiftNo]
      ,[IsDayEnd]
      ,[UpdateUnitNo]
      ,[SaleStatus]
      ,[RecallAvdInvoice]
      ,[AdvaneReceiptNo]
      ,[LoyaltyCardMasterID]
      ,[NOS]
      ,[CurrencyID]
      ,[CurrencyRate]
      /*,[CreatedOn]*/) AS DuplicateCount
  FROM dbo.PaymentDet where  CAST(ZDate as date) between '2024-11-16' and '2024-11-16')
select *
FROM CTE
WHERE LocationID='16' and DuplicateCount > 1

--DELETE
--FROM CTE
--WHERE DuplicateCount > 1
