WITH CTE ( [ProductID]
      ,[ProductCode]
      ,[RefCode]
      ,[BarCodeFull]
      ,[Descrip]
      ,[BatchNo]
      ,[SerialNo]
      ,[ExpiryDate]
      ,[Cost]
      ,[AvgCost]
      ,[Price]
      ,[Qty]
      ,[BalanceQty]
      ,[Amount]
      ,[UnitOfMeasureID]
      ,[UnitOfMeasureName]
      ,[ConvertFactor]
      ,[IDI1]
      ,[IDis1]
      ,[IDiscount1]
      ,[IDI1CashierID]
      ,[IDI2]
      ,[IDis2]
      ,[IDiscount2]
      ,[IDI2CashierID]
      ,[IDI3]
      ,[IDis3]
      ,[IDiscount3]
      ,[IDI3CashierID]
      ,[IDI4]
      ,[IDis4]
      ,[IDiscount4]
      ,[IDI4CashierID]
      ,[IDI5]
      ,[IDis5]
      ,[IDiscount5]
      ,[IDI5CashierID]
      ,[Rate]
      ,[IsSDis]
      ,[SDNo]
      ,[SDID]
      ,[SDIs]
      ,[SDiscount]
      ,[DDisCashierID]
      ,[Nett]
      ,[LocationID]
      ,[DocumentID]
      ,[BillTypeID]
      ,[SaleTypeID]
      ,[Receipt]
      ,[SalesmanID]
      ,[Salesman]
      ,[CustomerID]
      ,[Customer]
      ,[CashierID]
      ,[Cashier]
      ,[StartTime]
      ,[EndTime]
      ,[RecDate]
      ,[BaseUnitID]
      ,[UnitNo]
      ,[RowNo]
      ,[IsRecall]
      ,[RecallNO]
      ,[RecallAdv]
      ,[TaxAmount]
      ,[IsTax]
      ,[TaxPercentage]
      ,[IsStock]
      ,[UpdateBy]
      ,[Status]
      ,[ZNo]
      ,[GroupOfCompanyID]
     -- ,[DataTransfer]
      ,[CustomerType]
      ,[TransStatus]
      ,[ZDate]
      ,[IsPromotionApplied]
      ,[PromotionID]
      ,[IsPromotion]
      ,[LocationIDBilling]
      ,[TableID]
      ,[OrderTerminalID]
      ,[TicketID]
      ,[OrderNo]
      ,[IsPrinted]
      ,[ItemComment]
      ,[Packs]
      ,[IsCancelKOT]
      ,[StewardID]
      ,[StewardName]
      ,[ServiceCharge]
      ,[ServiceChargeAmount]
      ,[ShiftNo]
      ,[IsDayEnd]
      ,[UpdateUnitNo]
      ,[NOS]
      ,[SaleStatus]
      ,[AdvaneReceiptNo]
      ,[RecallAvdInvoice]
      ,[CurrencyID]
      ,[CurrencyRate]
      ,[ProductColorSizeID]
      ,[IsNonDiscount],DuplicateCount)
AS
(
  SELECT 
       [ProductID]
      ,[ProductCode]
      ,[RefCode]
      ,[BarCodeFull]
      ,[Descrip]
      ,[BatchNo]
      ,[SerialNo]
      ,[ExpiryDate]
      ,[Cost]
      ,[AvgCost]
      ,[Price]
      ,[Qty]
      ,[BalanceQty]
      ,[Amount]
      ,[UnitOfMeasureID]
      ,[UnitOfMeasureName]
      ,[ConvertFactor]
      ,[IDI1]
      ,[IDis1]
      ,[IDiscount1]
      ,[IDI1CashierID]
      ,[IDI2]
      ,[IDis2]
      ,[IDiscount2]
      ,[IDI2CashierID]
      ,[IDI3]
      ,[IDis3]
      ,[IDiscount3]
      ,[IDI3CashierID]
      ,[IDI4]
      ,[IDis4]
      ,[IDiscount4]
      ,[IDI4CashierID]
      ,[IDI5]
      ,[IDis5]
      ,[IDiscount5]
      ,[IDI5CashierID]
      ,[Rate]
      ,[IsSDis]
      ,[SDNo]
      ,[SDID]
      ,[SDIs]
      ,[SDiscount]
      ,[DDisCashierID]
      ,[Nett]
      ,[LocationID]
      ,[DocumentID]
      ,[BillTypeID]
      ,[SaleTypeID]
      ,[Receipt]
      ,[SalesmanID]
      ,[Salesman]
      ,[CustomerID]
      ,[Customer]
      ,[CashierID]
      ,[Cashier]
      ,[StartTime]
      ,[EndTime]
      ,[RecDate]
      ,[BaseUnitID]
      ,[UnitNo]
      ,[RowNo]
      ,[IsRecall]
      ,[RecallNO]
      ,[RecallAdv]
      ,[TaxAmount]
      ,[IsTax]
      ,[TaxPercentage]
      ,[IsStock]
      ,[UpdateBy]
      ,[Status]
      ,[ZNo]
      ,[GroupOfCompanyID]
     -- ,[DataTransfer]
      ,[CustomerType]
      ,[TransStatus]
      ,[ZDate]
      ,[IsPromotionApplied]
      ,[PromotionID]
      ,[IsPromotion]
      ,[LocationIDBilling]
      ,[TableID]
      ,[OrderTerminalID]
      ,[TicketID]
      ,[OrderNo]
      ,[IsPrinted]
      ,[ItemComment]
      ,[Packs]
      ,[IsCancelKOT]
      ,[StewardID]
      ,[StewardName]
      ,[ServiceCharge]
      ,[ServiceChargeAmount]
      ,[ShiftNo]
      ,[IsDayEnd]
      ,[UpdateUnitNo]
      ,[NOS]
      ,[SaleStatus]
      ,[AdvaneReceiptNo]
      ,[RecallAvdInvoice]
      ,[CurrencyID]
      ,[CurrencyRate]
      ,[ProductColorSizeID]
      ,[IsNonDiscount]
       ,ROW_NUMBER() OVER(PARTITION BY 
      [ProductID]
      ,[ProductCode]
      ,[RefCode]
      ,[BarCodeFull]
      ,[Descrip]
      ,[BatchNo]
      ,[SerialNo]
      ,[ExpiryDate]
      ,[Cost]
      ,[AvgCost]
      ,[Price]
      ,[Qty]
      ,[BalanceQty]
      ,[Amount]
      ,[UnitOfMeasureID]
      ,[UnitOfMeasureName]
      ,[ConvertFactor]
      ,[IDI1]
      ,[IDis1]
      ,[IDiscount1]
      ,[IDI1CashierID]
      ,[IDI2]
      ,[IDis2]
      ,[IDiscount2]
      ,[IDI2CashierID]
      ,[IDI3]
      ,[IDis3]
      ,[IDiscount3]
      ,[IDI3CashierID]
      ,[IDI4]
      ,[IDis4]
      ,[IDiscount4]
      ,[IDI4CashierID]
      ,[IDI5]
      ,[IDis5]
      ,[IDiscount5]
      ,[IDI5CashierID]
      ,[Rate]
      ,[IsSDis]
      ,[SDNo]
      ,[SDID]
      ,[SDIs]
      ,[SDiscount]
      ,[DDisCashierID]
      ,[Nett]
      ,[LocationID]
      ,[DocumentID]
      ,[BillTypeID]
      ,[SaleTypeID]
      ,[Receipt]
      ,[SalesmanID]
      ,[Salesman]
      ,[CustomerID]
      ,[Customer]
      ,[CashierID]
      ,[Cashier]
      ,[StartTime]
      ,[EndTime]
      ,[RecDate]
      ,[BaseUnitID]
      ,[UnitNo]
      ,[RowNo]
      ,[IsRecall]
      ,[RecallNO]
      ,[RecallAdv]
      ,[TaxAmount]
      ,[IsTax]
      ,[TaxPercentage]
      ,[IsStock]
      ,[UpdateBy]
      ,[Status]
      ,[ZNo]
      ,[GroupOfCompanyID]
     -- ,[DataTransfer]
      ,[CustomerType]
      ,[TransStatus]
      ,[ZDate]
      ,[IsPromotionApplied]
      ,[PromotionID]
      ,[IsPromotion]
      ,[LocationIDBilling]
      ,[TableID]
      ,[OrderTerminalID]
      ,[TicketID]
      ,[OrderNo]
      ,[IsPrinted]
      ,[ItemComment]
      ,[Packs]
      ,[IsCancelKOT]
      ,[StewardID]
      ,[StewardName]
      ,[ServiceCharge]
      ,[ServiceChargeAmount]
      ,[ShiftNo]
      ,[IsDayEnd]
      ,[UpdateUnitNo]
      ,[NOS]
      ,[SaleStatus]
      ,[AdvaneReceiptNo]
      ,[RecallAvdInvoice]
      ,[CurrencyID]
      ,[CurrencyRate]
      ,[ProductColorSizeID]
      ,[IsNonDiscount]
   ORDER BY 
       [ProductID]
      ,[ProductCode]
      ,[RefCode]
      ,[BarCodeFull]
      ,[Descrip]
      ,[BatchNo]
      ,[SerialNo]
      ,[ExpiryDate]
      ,[Cost]
      ,[AvgCost]
      ,[Price]
      ,[Qty]
      ,[BalanceQty]
      ,[Amount]
      ,[UnitOfMeasureID]
      ,[UnitOfMeasureName]
      ,[ConvertFactor]
      ,[IDI1]
      ,[IDis1]
      ,[IDiscount1]
      ,[IDI1CashierID]
      ,[IDI2]
      ,[IDis2]
      ,[IDiscount2]
      ,[IDI2CashierID]
      ,[IDI3]
      ,[IDis3]
      ,[IDiscount3]
      ,[IDI3CashierID]
      ,[IDI4]
      ,[IDis4]
      ,[IDiscount4]
      ,[IDI4CashierID]
      ,[IDI5]
      ,[IDis5]
      ,[IDiscount5]
      ,[IDI5CashierID]
      ,[Rate]
      ,[IsSDis]
      ,[SDNo]
      ,[SDID]
      ,[SDIs]
      ,[SDiscount]
      ,[DDisCashierID]
      ,[Nett]
      ,[LocationID]
      ,[DocumentID]
      ,[BillTypeID]
      ,[SaleTypeID]
      ,[Receipt]
      ,[SalesmanID]
      ,[Salesman]
      ,[CustomerID]
      ,[Customer]
      ,[CashierID]
      ,[Cashier]
      ,[StartTime]
      ,[EndTime]
      ,[RecDate]
      ,[BaseUnitID]
      ,[UnitNo]
      ,[RowNo]
      ,[IsRecall]
      ,[RecallNO]
      ,[RecallAdv]
      ,[TaxAmount]
      ,[IsTax]
      ,[TaxPercentage]
      ,[IsStock]
      ,[UpdateBy]
      ,[Status]
      ,[ZNo]
      ,[GroupOfCompanyID]
      --,[DataTransfer]
      ,[CustomerType]
      ,[TransStatus]
      ,[ZDate]
      ,[IsPromotionApplied]
      ,[PromotionID]
      ,[IsPromotion]
      ,[LocationIDBilling]
      ,[TableID]
      ,[OrderTerminalID]
      ,[TicketID]
      ,[OrderNo]
      ,[IsPrinted]
      ,[ItemComment]
      ,[Packs]
      ,[IsCancelKOT]
      ,[StewardID]
      ,[StewardName]
      ,[ServiceCharge]
      ,[ServiceChargeAmount]
      ,[ShiftNo]
      ,[IsDayEnd]
      ,[UpdateUnitNo]
      ,[NOS]
      ,[SaleStatus]
      ,[AdvaneReceiptNo]
      ,[RecallAvdInvoice]
      ,[CurrencyID]
      ,[CurrencyRate]
      ,[ProductColorSizeID]
      ,[IsNonDiscount]) AS DuplicateCount
  FROM dbo.TransactionDet where  CAST(ZDate as date) between '2017-09-01' and '2017-09-30')
select *
FROM CTE
WHERE LocationID='16' and DuplicateCount > 1

--DELETE
--FROM CTE
--WHERE DuplicateCount > 1
 
